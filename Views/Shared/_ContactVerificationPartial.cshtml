@model ReverseMarket.Models.Identity.ApplicationUser

@{
    // ✅ استخدام Identity بدلاً من Session
    var isLoggedIn = Context.User.Identity?.IsAuthenticated ?? false;
    var isAdmin = isLoggedIn && Context.User.IsInRole("Admin");

    bool canViewContact = isLoggedIn;
}

<h5 class="text-primary mb-3">
    <i class="fas fa-phone me-2"></i>
    التواصل
</h5>

@if (canViewContact)
{
    <div class="d-grid gap-2">
        <a href="tel:@Model.PhoneNumber" class="btn btn-outline-primary">
            <i class="fas fa-phone me-2"></i>
            اتصال مباشر
        </a>
        <a href="https://wa.me/@Model.PhoneNumber.Replace("+", "")" target="_blank" class="btn btn-success">
            <i class="fab fa-whatsapp me-2"></i>
            واتساب
        </a>
        @if (!string.IsNullOrEmpty(Model.Email))
        {
            <a href="mailto:@Model.Email" class="btn btn-outline-info">
                <i class="fas fa-envelope me-2"></i>
                بريد إلكتروني
            </a>
        }
        <a asp-controller="Chat" asp-action="Index" asp-route-withUser="@Model.PhoneNumber" class="btn btn-primary">
            <i class="fas fa-comments me-2"></i>
            مراسلة الآن
        </a>
    </div>
}
else
{
    <div class="alert alert-warning text-center">
        <i class="fas fa-lock mb-2 fa-2x"></i>
        <p class="mb-3">يجب تسجيل الدخول لعرض معلومات التواصل</p>
        <a href="/Account/Login" class="btn btn-primary">
            <i class="fas fa-sign-in-alt me-2"></i>
            تسجيل الدخول
        </a>
    </div>
}


